---
import type { GetStaticPaths, Page } from "astro";
import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";

import PagePagination from "@/components/PagePagination.astro";
import BaseLayout from "@/layouts/BaseLayout.astro";
import PostList from "@/layouts/PostList.astro";

export const getStaticPaths: GetStaticPaths = async ({ paginate }) => {
  const posts = (
    await getCollection("blog", ({ data }) =>
      import.meta.env.PROD ? !data.draft : true,
    )
  ).sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

  return paginate(posts, { pageSize: 10 });
};

type Props = {
  page: Page<CollectionEntry<"blog">>;
};

const { page } = Astro.props;

if (page.currentPage === 1) {
  return Astro.redirect("/");
}
---

<BaseLayout>
  {page.url.prev && <link rel="prev" href={page.url.prev} slot="head" />}
  {
    page.url.next && (
      <link
        rel="next"
        href={page.currentPage === 2 ? "/" : page.url.next}
        slot="head"
      />
    )
  }
  <div class="prose py-6">
    <PostList page={page} />
  </div>
  <PagePagination page={page} />
</BaseLayout>
